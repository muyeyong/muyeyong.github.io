---
title: ä»£ç ä¼˜åŒ–-åˆ·æ–°ç•Œé¢åæ€ä¹ˆä¿å­˜ç”¨æˆ·æ•°æ®
top: false
cover: false
toc: true
mathjax: true
date: 2020-08-13 16:27:39
password:
summary: å’¦ï¼Œæˆ‘æ•°æ®å’‹ä¸è§äº†äº†ï¼Ÿ
tags: ç”¨æˆ·æ•°æ®ä¿å­˜
categories: ä»£ç ä¼˜åŒ–
---

# ä»£ç ä¼˜åŒ–-åˆ·æ–°ç•Œé¢åæ€ä¹ˆä¿å­˜ç”¨æˆ·æ•°æ®

å…ˆä¸Šä¸€å¼ å›¾ï¼š

![](1.gif)

æ˜¯ä¸æ˜¯è§‰å¾—çœ‹äº†ä¸ªå¯‚å¯ï¼Œæ„Ÿè§‰ä¹Ÿæ²¡å•¥å˜åŒ–ï¼Œæ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆä¸æ˜¾çœ¼çš„ä¼˜åŒ–ï¼Œåœ¨è¿™ä¸ªğŸŒ°ä¸­ï¼Œæ¯æ¬¡åˆ·æ–°ä¿æŒäº†ç”¨æˆ·é€‰æ‹©çš„åœ°åŒºæ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œä¿å­˜äº†ç”¨æˆ·æ•°æ®ï¼Œæœ€å¼€å§‹æ˜¯æƒ³ç”¨vueçš„è·¯ç”±æ¥åšï¼Œä½†æ˜¯æ•ˆæœä¸å¤ªå¥½æ˜¯(~~æ˜¯æˆ‘å¤ªèœ~~ ï¼Œä½¿ç”¨queryå’Œparamsåœ¨åˆ·æ–°çš„æ—¶å€™ä¼šä¸¢å¤±èµ‹å€¼ï¼Œå¼ºè¡Œä½¿ç”¨`window.history`ä¼šå¼•å‘åœ°å€æ··ä¹±)ï¼Œæœ€åé€‰æ‹©ç”¨`sessionStorage`å®ç°ï¼Œå¯ä»¥å¾ˆç®€å•çš„å®ç°ï¼šåˆ·æ–°é¡µé¢æˆ–åˆšè¿›å…¥é¡µé¢çš„æ—¶å€™å»å–å­˜å‚¨çš„å€¼ï¼Œæ²¡æœ‰çš„è¯èµ‹é»˜è®¤å€¼ï¼Œæ¯æ¬¡å½“ç”¨æˆ·æ•°æ®æ”¹å˜çš„æ—¶å€™å°†æ”¹å˜çš„å€¼å­˜å‚¨èµ·æ¥ï¼Œoverï¼ï¼ä½†æ˜¯ä½œä¸ºä¸€ä¸ª~~ä¼˜ç§€çš„å‰ç«¯å·¥ç¨‹å¸ˆ~~ï¼Œæˆ‘è‚¯å®šæœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œé¦–å…ˆåˆ†æä¸€ä¸‹ä¸Šé¢çš„æ–¹æ³•æœ‰å“ªäº›ä¸å¥½çš„åœ°æ–¹ï¼š

1. å½“ç”¨æˆ·æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œå°±å°†æ•°æ®å­˜èµ·æ¥ï¼Œæ˜¯ä¸å¥½å¤ªæµªè´¹äº†ï¼Ÿæˆ‘ä»¬åªéœ€è¦å­˜å‚¨æœ€ç»ˆçš„æ•°æ®å³å¯ï¼Œ~~å°å­©å­æ‰çœ‹è¿‡ç¨‹ï¼Œæˆå¹´äººåªè¦ç»“æœ~~
2. è·å–å’Œå­˜å‚¨ç”¨æˆ·æ•°æ®çš„æ—¶å€™éƒ½éœ€è¦å»å†™`sessionStorege.setItem(xxx)\.getItem(xxx) ` æ˜¯ä¸æ˜¯è§‰å¾—ä»£ç ä¸å¤Ÿä¼˜é›…?
3. å•Šå§å•Šå§ã€‚ã€‚ã€‚ã€‚ã€‚

æ¥ä¸‹æ¥å°±æ˜¯å±•ç¤ºçœŸæ­£çš„æŠ€æœ¯äº†

## ä½¿ç”¨sessionStorage

ä¸ºä»€ä¹ˆä½¿ç”¨`sessionStorage` ä¸ä½¿ç”¨`localStorage`?

â€‹	æˆ‘å½“å‰çš„åº”ç”¨åœºæ™¯æ˜¯ä¿å­˜ç”¨æˆ·çš„æœç´¢ğŸ”æ¡ä»¶ï¼Œå¹¶ä¸éœ€è¦æ°¸ä¹…çš„ä¿å­˜å°†æ•°æ®å­˜å‚¨ã€‚

æˆ‘åœ¨å†™çš„é¡¹ç›®å‰ç«¯ä½¿ç”¨çš„æ¡†æ¶æ˜¯Vueï¼Œæˆ‘å°±åˆ©ç”¨äº†`Vuex + æµè§ˆå™¨äº‹ä»¶ç›‘å¬ + VueRouteè·¯ç”±é’©å­å‡½æ•°`å®ç°äº†éœ€è¦çš„æ•ˆæœ

é¦–å…ˆæ˜ç¡®æˆ‘ä»¬éœ€è¦å­˜å‚¨çš„ç”¨æˆ·æ•°æ®æ˜¯é€‰æ‹©çš„åœ°åŒºè¿™ä¸ªå­—æ®µï¼Œåœ¨è¿™é‡Œå‘½åä¸º`activeRegionName`ï¼Œå°†å®ƒæ”¾åˆ°storeé‡Œé¢ï¼Œä½†æ˜¯storeé‡Œé¢çš„æ•°æ®å¹¶ä¸éƒ½è¦å­˜å‚¨èµ·æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæ•°ç»„è®°å½•éœ€è¦å­˜å‚¨åˆ°storeé‡Œé¢æ•°æ®çš„åå­—ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š

![](Snipaste_2020-08-13_21-03-24.png)

ä½¿ç”¨`getter`å°†stateæš´éœ²å‡ºå»(æœ€å¼€å§‹æˆ‘ä»¥ä¸ºç›´æ¥ä½¿ç”¨...mapState()å¼•å…¥å³å¯ï¼Œä½†æ˜¯ä¸è¡Œï¼Œéœ€è¦ä½¿ç”¨...mapGetters())ï¼Œåœ¨`mutations`å¯¹å¤–æä¾›æ“ä½œstateé‡Œé¢æ•°æ®çš„æ–¹æ³•,ä»£ç å¦‚ä¸‹ï¼š

```
 //å·¥å…·æ–¹æ³•
 const storeLocalStore = (value)=>{
    sessionStorage.setItem(STORAGEKEY,JSON.stringify(value))
}
///////////////////////////
 getters :{
        activeRegionName: state => state.activeRegionName
    },
 mutations : {
        setStoreData(state){
            let updataData = {}
            storeDataName.forEach(item =>{
                updataData[item] = state[item]
            })
            storeLocalStore(updataData)
        },
        getStoreData(state){
            let storeData = JSON.parse(sessionStorage.getItem(STORAGEKEY)) 
            if(!storeData) return 
            storeDataName.forEach(item=>{
                if(storeData[item]&& state.hasOwnProperty(item)){
                    state[item] = storeData[item]
                }
            })
        },
        changeActiveRegionName(state,value){
            state.activeRegionName = value
        }
    },    
```

åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬å¯ä»¥å°†`activeRegionName`å­˜å‚¨åˆ°`sessionStorege`é‡Œé¢å»äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦å®Œæˆçš„æ˜¯ç›‘å¬åˆ·æ–°æ“ä½œå’Œurlå˜åŒ–çš„æ“ä½œ

åœ¨`methods` é‡Œé¢ä½¿ç”¨ `...mapMutations()`å¼•å…¥`mutations`é‡Œé¢çš„æ–¹æ³•ï¼Œåœ¨`computed`é‡Œé¢ä½¿ç”¨`...mapGetters()`å¼•å…¥stateé‡Œé¢çš„æ•°æ®ã€‚

åœ¨`mounted()`é‡Œé¢æ·»åŠ æµè§ˆå™¨åˆ·æ–°çš„ç›‘å¬äº‹ä»¶ï¼Œ`destroyed()`é‡Œåˆ é™¤ç›‘å¬äº‹ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
mounted() {
     this.registEventListener()
  },
destroyed(){
     this.cancelEventListenner()
  },
registEventListener(){
  window.addEventListener('beforeunload', e => this.beforeunloadFn(e))
  },
cancelEventListenner(){
  window.removeEventListener('beforeunload', e => this.beforeunloadFn(e))
  },
beforeunloadFn(){
  this.setStoreData()
  },
```

è‡³æ­¤åœ¨åˆ·æ–°æ—¶ä¿å­˜ç”¨æˆ·æ•°æ®æˆ‘ä»¬å·²ç»å®ç°äº†ï¼Œä½†æ˜¯è¿™ä¸ªéœ€æ±‚é‡Œé¢è¿˜æœ‰ä¸€ä¸ªæ“ä½œæ˜¯å³ä¸Šè§’æœ‰ä¸ªè·³è½¬ï¼Œä¹Ÿéœ€è¦åœ¨è¿™ä¸ªæ“ä½œçš„æ—¶å€™å­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œç„¶è€Œè¿™ä¸ªæ“ä½œå¹¶ä¸ä¼šè§¦å‘`beforeunload`è¿™ä¸ªæ—¶é—´ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨[VueRouter](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E7%BB%84%E4%BB%B6%E5%86%85%E7%9A%84%E5%AE%88%E5%8D%AB)çš„é’©å­å‡½æ•°äº†ï¼Œ`beforeRouteLeave`ç›´æ¥æ”¾åˆ°è·Ÿ`methods`åŒçº§å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
 beforeRouteLeave(to, from, next){
     this.setStoreData()
     next()
 },
```

è¿™æ ·çš„è¯æˆ‘ä»¬çš„éœ€æ±‚å°±å®ç°äº†

## ä½¿ç”¨URLå­˜å‚¨

è¿˜éœ€è¦ç­‰æˆ‘è¯•éªŒå®Œåœ¨å†™ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚