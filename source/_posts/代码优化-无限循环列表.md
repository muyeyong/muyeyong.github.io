---
title: ä»£ç ä¼˜åŒ–-æ— é™å¾ªç¯åˆ—è¡¨
top: false
cover: false
toc: true
mathjax: true
date: 2021-01-12 11:53:21
password:
summary: æ— é™å¾ªç¯æ€»æ˜¯è®©äººç—´è¿·
tags: æ— é™å¾ªç¯
categories: ä»£ç ä¼˜åŒ–
---

# æ— é™å¾ªç¯åˆ—è¡¨Vueå®ç°

ä¸ºäº†å®ç°ä¸Šæ¬¡çš„æ‰¿è¯º{% post_link ç»éªŒ-å¼€å‘æ€»ç»“ ç‚¹å¼€è¿™é‡Œ %}ï¼Œæˆ‘åˆ†è£…äº†ä¸€ä¸ªç»„ä»¶ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯ï¼š

1. è‡ªåŠ¨æ»šåŠ¨
2. æ— é™å¾ªç¯
3. ä¸æ–­è¯·æ±‚æ•°æ®

ç³»ç»Ÿé‡Œé¢æœ‰ç±»ä¼¼çš„ç»„ä»¶ï¼ˆåŸºäºhappy-scrollå®ç°ï¼‰ï¼Œä½†æ˜¯é™¤äº†ä¸å¤ªå¥½ç”¨ä¹‹å¤–ï¼ŒåŠŸèƒ½ä¸Šæ²¡æœ‰å®ç°æ— é™å¾ªç¯ä»¥åŠåªèƒ½å±•ç¤ºå›ºå®šçš„æ•°æ®ã€‚

[æ¼”ç¤ºåœ°å€](http://meyeyong.top/#/autoScrollList)ï¼Œè¿™ä¸ªæ¼”ç¤ºåªèƒ½å®ç°å•å‘æ»šåŠ¨ï¼Œè·Ÿæˆ‘è¦å®ç°çš„ä¸å¤ªä¸€æ ·ï¼Œä¸è¿‡è«æ€¥ï¼Œçœ‹ğŸ‘‡

![](https://i.loli.net/2021/01/12/CiQVAFOmncoXa57.gif)



å¥½åƒä¸æ˜¯å¾ˆç›´è§‚ï¼Œå¯ä»¥çœ‹å³è¾¹çš„æ»šåŠ¨æ¡ï¼Œåˆ°äº†é¡¶éƒ¨å’Œåº•éƒ¨ä¼šè‡ªåŠ¨åŠ è½½æ•°æ®æ•°æ®ï¼Œæ»‘åˆ°é¡¶éƒ¨ä¼šè‡ªåŠ¨æ»šåŠ¨åˆ°è¯·æ±‚æ•°æ®çš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œçœ‹ä¸‹å›¾

![](https://i.loli.net/2021/01/12/VM74hy6wjckId2i.gif)

## ä½¿ç”¨

![](https://i.loli.net/2021/01/12/YmDXGanglLoe5jt.png)

ç»„ä»¶åï¼šesay-auto-scroll-list

å±æ€§ï¼š

| å±æ€§     |                                                   |
| -------- | ------------------------------------------------- |
| width    | è®¾ç½®ç»„ä»¶çš„å®½                                      |
| height   | è®¾ç½®ç»„ä»¶çš„é«˜                                      |
| haveData | çŠ¶æ€ï¼Œæ˜¯å¦æœ‰æ•°æ®                                  |
| loading  | çŠ¶æ€ï¼Œæ˜¯å¦åœ¨åŠ è½½æ•°æ®ï¼ˆè¯·æ±‚æ•°æ®æ˜¯å¦è¿”å›ï¼‰          |
| flag     | æ¯ä¸ªulçš„å”¯ä¸€æ ‡å¿—ï¼Œulå¿…é¡»å¢åŠ data-flagçš„è‡ªå®šä¹‰æ ‡ç­¾ |
| notice   | å½“æ»šåˆ°åº•/é¡¶éƒ¨çš„å›è°ƒå‡½æ•°                           |

**æ³¨æ„ç‚¹**

1. ç»„ä»¶åªæ˜¯å®ç°æ•°æ®çš„æ»šåŠ¨ï¼Œä»¥åŠæ»šåŠ¨åˆ°è¾¹ç•Œï¼ˆé¡¶/åº•ï¼‰è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå…·ä½“è¦å®ç°æ— é™ä¸Šä¸‹æ»šåŠ¨ or å•å‘æœ‰é™æ»šåŠ¨ or å…¶ä»–ï¼Œéœ€è¦å›è°ƒå‡½æ•°çš„é…åˆï¼ˆåœ¨çº¿å®ä¾‹å’Œåšå®¢åŠ¨å›¾å°±æ˜¯å›è°ƒå‡½æ•°çš„ä¸åŒï¼Œæ•ˆæœå°±ä¸ä¸€æ ·ï¼‰
2. haveDataå’Œloadingæ˜¯æ ¹æ®å®é™…è¿”å›æ•°æ®è®¾ç½®çš„ã€‚åœ¨å‘é€è¯·æ±‚å‰ï¼ŒhavaData=false loading=trueã€‚è¯·æ±‚ç»“æŸåï¼ŒhaveDataæ ¹æ®å®é™…æƒ…å†µè®¾ç½®ï¼Œloading=false

## ç»„ä»¶

[ç»„ä»¶æºç ](https://github.com/muyeyong/eleAnimation/tree/master/src/components/autoScrollList)ï¼Œæ³¨æ„ä¹Ÿè¦ä½¿ç”¨config.jsé…ç½®æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®æ€»è¯·ä½¿ç”¨ autoScrollListå®é™…ä½¿ç”¨ç‰ˆæœ¬.vue

### çŸ¥è¯†ç‚¹

#### clientHeight

> è·Ÿå…ƒç´ çš„æ»šåŠ¨å’Œä½ç½®æ— å…³ï¼Œä»£è¡¨å…ƒç´ çš„é«˜åº¦ï¼ŒåŒ…æ‹¬paddingä½†ä¸åŒ…æ‹¬borderã€æ°´å¹³æ»šåŠ¨æ¡ã€marginçš„å…ƒç´ çš„é«˜åº¦ã€‚å¯¹äºinlineçš„å…ƒç´ è¿™ä¸ªå±æ€§ä¸€ç›´æ˜¯0ï¼Œå•ä½pxï¼Œåªè¯»å±æ€§

![](https://i.loli.net/2021/01/12/zsxjP1mvtH2deqI.png)

#### offsetHeight

> è·Ÿå…ƒç´ çš„æ»šåŠ¨å’Œä½ç½®æ— å…³ï¼Œä»£è¡¨å…ƒç´ çš„é«˜åº¦ï¼ŒåŒ…æ‹¬paddingã€borderã€æ°´å¹³æ»šåŠ¨æ¡ï¼Œä½†ä¸åŒ…æ‹¬marginçš„å…ƒç´ çš„é«˜åº¦ã€‚å¯¹äºinlineçš„å…ƒç´ è¿™ä¸ªå±æ€§ä¸€ç›´æ˜¯0ï¼Œå•ä½pxï¼Œåªè¯»å±æ€§

![](https://i.loli.net/2021/01/12/JbRHgh2jAYTUSf9.png)

#### scrollHeight

> è·Ÿæ»šåŠ¨æ¡æœ‰å…³ï¼ˆå­å…ƒç´ é«˜äºçˆ¶å…ƒç´ ï¼‰ï¼Œä»£è¡¨å½“å‰ä¸å¯è§éƒ¨åˆ†çš„é«˜åº¦ï¼Œå¯è§éƒ¨åˆ†å°±æ˜¯clientHeightï¼Œå•ä½pxï¼Œåªè¯»å±æ€§

![](https://i.loli.net/2021/01/12/1MeUT4qCDPvnRlL.png)

**åˆ¤æ–­æ˜¯å¦æ»‘åˆ°åº•éƒ¨ï¼š ele.scrollHeight - ele.scrollTop ==== ele.clientHeight**

#### scrollTop

> ä»£è¡¨åœ¨æœ‰æ»šåŠ¨æ¡æ—¶ï¼Œæ»šåŠ¨æ¡å‘ä¸‹æ»šåŠ¨çš„è·ç¦»ä¹Ÿå°±æ˜¯å…ƒç´ é¡¶éƒ¨è¢«é®ä½éƒ¨åˆ†çš„é«˜åº¦ã€‚åœ¨æ²¡æœ‰æ»šåŠ¨æ¡æ—¶`scrollTop==0`æ’æˆç«‹ã€‚å•ä½pxï¼Œå¯è¯»å¯å†™å±æ€§

![](https://i.loli.net/2021/01/12/4d7tY8A6FbTZjsq.png)

 #### offsetTop

> å®ƒè¿”å›å½“å‰å…ƒç´ ç›¸å¯¹äºå…¶ offsetParent å…ƒç´ çš„é¡¶éƒ¨çš„è·ç¦»ï¼ˆå­è¾¹æ¡†å¤–ä¾§åˆ°çˆ¶è¾¹æ¡†çš„å†…å­˜çš„è·ç¦»ï¼‰,å•ä½pxï¼Œåªè¯»å±æ€§

#### clientTop

> ä¸€ä¸ªå…ƒç´ é¡¶éƒ¨è¾¹æ¡†çš„å®½åº¦ï¼Œä¸åŒ…æ‹¬é¡¶éƒ¨å¤–è¾¹è·æˆ–å†…è¾¹è·ã€‚å¯ä»¥ç†è§£æˆå®šä¹‰`border`çš„é«˜åº¦ï¼Œå•ä½pxï¼Œåªè¯»å±æ€§

### åŸºæœ¬æ€è·¯

ä¸Šæ»‘é¡¶éƒ¨ï¼šå½“å‘å‡ºè¯·æ±‚å‰ï¼ˆè°ƒç”¨å›è°ƒå‡½æ•°å‰ï¼‰ï¼Œä¿å­˜å½“å‰åˆ—è¡¨ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®ä»¥åŠscrollTopå’ŒoffetHeightã€‚å½“è¯·æ±‚ç»“æŸåï¼Œæ›´æ–°å®Œæ•°æ®ï¼Œå°†ä¿å­˜çš„æ•°æ®æ’å…¥åˆ°æœ€æ–°æ•°æ®çš„åé¢ï¼Œå¹¶æ›´æ–°scrollTopä¿æŒè§†è§‰ä¸Šçš„è¿ç»­æ€§ã€‚

ä¸‹æ»‘åˆ°åº•éƒ¨ï¼šå½“å‘å‡ºè¯·æ±‚å‰ï¼ˆè°ƒç”¨å›è°ƒå‡½æ•°å‰ï¼‰ï¼Œä¿å­˜å½“å‰åˆ—è¡¨æœ€åä¸€æ¡æ•°æ®ä»¥åŠscrollTopå’ŒoffetHeightã€‚å½“è¯·æ±‚ç»“æŸåï¼Œæ›´æ–°å®Œæ•°æ®ï¼Œå°†ä¿å­˜çš„æ•°æ®æ’å…¥åˆ°æœ€æ–°æ•°æ®çš„å‰é¢ï¼Œå¹¶æ›´æ–°scrollTopä¿æŒè§†è§‰ä¸Šçš„è¿ç»­æ€§ã€‚

### æ³¨æ„ç‚¹

1. ä¿å­˜çš„çš„offsetHeightæ˜¯å¤šä¸ªå­å…ƒç´ çš„offsetHeightçš„é›†åˆ
2. ä½¿ç”¨`insertBefore`æ’å…¥çš„å…ƒç´ ï¼Œåœ¨ä¸‹ä¸€æ¬¡æ›´æ–°æ•°æ®æ—¶ï¼Œå¯èƒ½è¿˜ä¼šä¿å­˜ï¼Œéœ€è¦å»é™¤å¤šä½™çš„å­å…ƒç´ ï¼ˆå”¯ä¸€æ ‡å¿—flagçš„ä½œç”¨ï¼‰
3. æœ€åä¸€ç»„æ•°æ®æ¯”è¾ƒç‰¹æ®Šï¼Œæ•°é‡å¯èƒ½æ²¡æœ‰æœ€å¼€å§‹è¯·æ±‚é‚£ä¹ˆå¤šã€‚ä¾‹å¦‚è®¾ç½®çš„è¯·æ±‚æ•°é‡æ˜¯10æ¡ï¼Œä½†æœ€åä¸€ç»„æ•°æ®å¯èƒ½åªæœ‰1æ¡ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ã€‚

### å›è°ƒå‡½æ•°

å›è°ƒå‡½æ•°æ˜¯å®ç°éœ€è¦æ•ˆæœçš„å…³é”®ï¼Œå°±æ˜¯çœ‹ä½ æ€ä¹ˆå¤„ç†è¾¹ç•Œä½ç½®çš„æƒ…å†µï¼Œä¸‹é¢æ˜¯æˆ‘çš„å®ä¾‹ï¼š

```
async  loadData(type){
            this.loading = true
            this.moreData = false 
            this.flag++
            let page 
            if(type === scrollDir.down){
             if(this.endPage === this.totalPage){
                 this.endPage = 1
                 this.startPage = this.totalPage
             }else{
                const newStartPage = (this.startPage+1)%this.totalPage
                const newEndPage = (this.endPage+1)%this.totalPage
                this.endPage = newEndPage===0? this.totalPage: newEndPage
                this.startPage = this.endPage%this.totalPage - 1>0? this.endPage%this.totalPage - 1: this.totalPage
             }
             page = this.endPage
           }else if(type === scrollDir.up){
               if(this.startPage<=1){
                   this.startPage = this.totalPage
                   this.endPage = 1
               }else{
                   const newStartPage = this.startPage-1
                   const newEndPage = this.endPage-1
                   this.startPage = newStartPage>0? newStartPage:1
                   this.endPage = this.startPage%this.totalPage + 1
               }
               page = this.startPage
           }
            this.investProjectList = await this.getInvestProjectsData({page})
            this.totalPage = this.investProjectList.pages
            this.moreData = true
            this.loading = false
        },
```

#### æ³¨æ„ç‚¹

1. éœ€è¦å®šä¹‰startPage å’Œ endPageä¸¤ä¸ªå˜é‡è·Ÿè¸ªpageå˜åŒ–ï¼Œä¹‹æ‰€ä»¥è¦ä¸¤ä¸ªå˜é‡æ˜¯å› ä¸ºå½“å‰å¯è§†çª—å£å¯ä»¥å­˜åœ¨å¤šä¸ªå­å…ƒç´ 

![](https://i.loli.net/2021/01/12/LzReYxk9pgFIyUt.png)

2. ä¸Šæ»‘endPageæ ¹æ®startPageå˜åŒ–ï¼Œä¸‹æ»‘startPageæ ¹æ®endPageå˜åŒ–

## æ€»ç»“

è¿™æ¬¡å®ç°è¿™ä¸ªåŠŸèƒ½ç”¨çš„æ—¶é—´å¤ªé•¿äº†ï¼Œå†™åˆ°ä¸€åŠçš„æ—¶å€™å‘ç°ä¸è¡Œï¼Œåˆæ¨åˆ°é‡æ¥äº†ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼Œä¼šè¿™æ ·è¿˜æ˜¯å› ä¸ºè‡ªå·±å‰æœŸæ²¡æœ‰è€ƒè™‘ä»”ç»†å°±å¼€å§‹å†™ä»£ç ï¼Œè¿å†™ä»€ä¹ˆä¸œè¥¿éƒ½ä¸æ˜ç¡®ï¼Œéœ€è¦åæ€ã€‚